Development Tools
yum groupinstall "Development Tools"
yum install openssl-devel.x86_64  cyrus-sasl  cyrus-sasl-devel

GCC
wget http://people.centos.org/tru/devtools-2/devtools-2.repo -O /etc/yum.repos.d/devtools-2.repo
yum install devtoolset-2-gcc devtoolset-2-binutils
yum install devtoolset-2-gcc-c++ devtoolset-2-gcc-gfortran
scl enable devtoolset-2 bash
source /opt/rh/devtoolset-2/enable

Build Berkley DB
cd /home/admin
tar -zxvf db-5.3.28.tar.gz
mv db-5.3.28 db
cd /home/admin/db/build_unix
chmod -R 755 /home/admin/db
../dist/configure;make;make install
** /usr/local/BerkeleyDB.5.3/docs

vi /etc/ld.so.conf.d/db-5.3.conf
/usr/local/BerkeleyDB.5.3/lib
ldconfig 
Build OpenLdap
cd /home/admin
tar -zxvf openldap-2.4.50.tgz
mv openldap-2.4.50 openldap
cd /home/admin/openldap
env CPPFLAGS="-I/usr/local/BerkeleyDB.5.3/include" LDFLAGS="-L/usr/local/BerkeleyDB.5.3/lib" ./configure --sysconfdir=/etc  --enable-ldap    --enable-slapd  --enable-bdb --with-cyrus-sasl  --with-tls=openssl   --enable-rewrite --enable-rlookups    --enable-dynamic --enable-ppolicy  --enable-memberof  --enable-refint --enable-sssvlv;make depend;make;make install

Check that slapd does not missing some referenced libraries
ldd /usr/local/libexec/slapd
Configure the OpenLDAP
Configure the LDAP Server
Back up default configuration file
mv /etc/openldap/slapd.conf /etc/openldap/slapd.conf.orig

vi /etc/openldap/slapd.conf

Test Configuration file
/usr/local/sbin/slaptest -f /etc/openldap/slapd.conf -v

You will receive warning
bdb_db_open: warning - no DB_CONFIG file found in directory /usr/local/var/openldap-data: (2).

rm -rf /etc/openldap/slapd.d/*
cp /usr/local/var/openldap-data/DB_CONFIG.example /usr/local/var/openldap-data/DB_CONFIG

Create ldap user
adduser  ldap -g ldap
?????chmod -R 0700 /var/lib/ldap
mkdir /var/run/slapd
chown -R ldap:ldap /usr/local/var/openldap-data/
chown -R ldap:ldap /etc/openldap/slapd.d
chown -R ldap:ldap /var/run/slapd

To create id2entry.bdb run slapd at least once
Run slapd server
/usr/local/libexec/slapd
pidof slapd

Stop slapd server
kill `pgrep slapd`

Re-test configuration file
/usr/local/sbin/slaptest -f /etc/openldap/slapd.conf -v


Configuring the LDAP Clients
vi /etc/openldap/ldap.conf


Run slapd server
/usr/local/libexec/slapd
pidof slapd

At this point you should be able to run following commands
ldapsearch -x -W -D 'cn=manager,dc=company,dc=com' -b "" -s base

ldapsearch -x -W -D 'cn=manager,dc=company,dc=com' -b "" -s base \  	'(objectclass=*)' +
ldapsearch -LLL -x -W -D 'cn=manager,dc=company,dc=com' -H \
 ldap://192.168.1.14 -ZZ '(uid=manny)'
Import sample data
from basics.ldif

To import through slapadd
Run in test mode to verify integrity: slapadd -v -u -c -f /etc/openldap/slapd.conf -l basics.ldif
Stop Server
Execute the import: slapadd -v -f /etc/openldap/slapd.conf -l basics.ldif
Start server



IPTABLES
/sbin/iptables -I INPUT -p udp -s 192.168.50.0/24 --dport 389 -j ACCEPT
/sbin/iptables -I INPUT -p tcp -s 192.168.50.0/24 --dport 389 -j ACCEPT
/sbin/iptables -I INPUT -p udp -s 192.168.50.0/24 --dport 636 -j ACCEPT
/sbin/iptables -I INPUT -p tcp -s 192.168.50.0/24 --dport 636 -j ACCEPT
/sbin/iptables -I INPUT -p udp -s 192.168.1.0/24 --dport 636 -j ACCEPT
/sbin/iptables -I INPUT -p tcp -s 192.168.1.0/24 --dport 636 -j ACCEPT
service iptables save
service iptables restart

Who is listening port
netstat -tulpn |grep :636
ps -ef | grep slapd
netstat -lnp | grep slapd

Verify Installation
/usr/local/libexec/slapd -VVV
strings /usr/local/bin/ldapmodify | grep "\.so"

Example commands
Search
ldapsearch -x -W -D 'cn=Manager,dc=company,dc=com' -b \ 	'ou=Users,dc=company,dc=com' '(uid=barbara)'

Ldap Search Filter for identity
(&(objectCategory=user)(sAMAccountName=Alan.Bradley))

To check the database suffix, once the server is running, use ldapsearch(1) to read the namingContexts attribute of the root DSE:

ldapsearch -x -s base -b "" namingContexts
Useful Links
http://xionghuilin.com/rhel6-ldap-server-configuration-issue-and-solve/comment-page-1/

https://wiki.gentoo.org/wiki/Centralized_authentication_using_OpenLDAP
https://books.google.co.il/books?id=HmydDwAAQBAJ&pg=PA57&lpg=PA57&dq=%22ldapsearch+-x+-b%22+%22No+Such+object%22&source=bl&ots=BGfK6WcUWM&sig=ACfU3U3DXLWdID9_3l2WPWnFtYjDJIjUgQ&hl=en&sa=X&ved=2ahUKEwjyiefk2obpAhXSzaQKHfeKDrgQ6AEwAnoECAkQAQ#v=onepage&q=%22ldapsearch%20-x%20-b%22%20%22No%20Such%20object%22&f=false


CHECKED ON KALI
sudo apt-get install libssl-dev
sudo apt-get install libsasl2-dev


curl -L https://www.openldap.org/software/download/OpenLDAP/openldap-release/openldap-2.5.7.tgz --output openldap-2.5.7.tgz
	tar -zxvf openldap-2.5.7.tgz
	mv openldap-2.5.7 openldap
	cd openldap
	env CPPFLAGS=" -I/opt/openssl" LDFLAGS="-L/usr/lib64 -L/opt/openssl/lib" ./configure --sysconfdir=/etc  --enable-ldap    --enable-slapd --with-cyrus-sasl  --with-tls=openssl   --enable-rewrite --enable-rlookups    --enable-dynamic --enable-ppolicy  --enable-memberof  --enable-refint ;
	make depend; make;make install